# ALERT_FORMAT.md — NeuroSec Alert Specification

## File Naming Convention

| Severity | Filename Pattern | Example |
|----------|------------------|---------|
| **EMERGENCY** | `EMERGENCY-{category}-{timestamp}.md` | `EMERGENCY-EXFIL-20260208-204215.md` |
| **CRITICAL** | `CRITICAL-{category}-{timestamp}.md` | `CRITICAL-AWS-KEY-20260208-204215.md` |
| **HIGH** | `HIGH-{category}-{timestamp}.md` | `HIGH-PERMISSION-20260208-204215.md` |
| **MEDIUM** | `MEDIUM-{category}-{timestamp}.md` | `MEDIUM-NETWORK-20260208-204215.md` |
| **LOW** | `LOW-{category}-{timestamp}.md` | `LOW-CONFIG-20260208-204215.md` |
| **REVIEW** | `REVIEW-{category}-{timestamp}.md` | `REVIEW-SUSPICIOUS-20260208-204215.md` |
| **Digest** | `digest-{YYYYMMDD}.md` | `digest-20260208.md` |

### Emergency Categories
- `EXFIL` - Data exfiltration detected
- `RANSOMWARE` - Ransomware indicators
- `PRIVESC` - Privilege escalation
- `BREACH` - Active breach indicators

### Standard Categories
- `SECRET` - Exposed secret/credential
- `PERMISSION` - Permission anomaly
- `NETWORK` - Network exposure/anomaly
- `PROCESS` - Suspicious process
- `DEPENDENCY` - Supply chain risk
- `GIT` - Git hygiene issue
- `CONFIG` - Configuration weakness

---

## YAML Frontmatter Schema

```yaml
---
alert_id: "ns-{timestamp}-{random-hex}"
severity: "EMERGENCY|CRITICAL|HIGH|MEDIUM|LOW|REVIEW"
category: "EXFIL|SECRET|PERMISSION|NETWORK|PROCESS|DEPENDENCY|GIT|CONFIG"
confidence: "High|Medium|Low|SUSPICIOUS"
detected_at: "2026-02-08T20:42:15Z"
agent: "NeuroSec"
model: "openrouter/moonshotai/kimi-k2.5"
file_count: 1
false_positive_likelihood: "Low|Medium|High"
duplicate_count: 0
workflow: "Heartbeat|PostWrite|DeepAudit|Emergency"
---
```

### Field Definitions

| Field | Type | Description |
|-------|------|-------------|
| `alert_id` | string | Unique identifier: `ns-{YYYYMMDD-HHMMSS}-{8-char-hex}` |
| `severity` | enum | Alert severity level |
| `category` | enum | Alert classification |
| `confidence` | enum | Certainty of finding |
| `detected_at` | ISO8601 | UTC timestamp of detection |
| `agent` | string | Always "NeuroSec" |
| `model` | string | AI model used for analysis |
| `file_count` | integer | Number of files involved |
| `false_positive_likelihood` | enum | Estimated FP chance |
| `duplicate_count` | integer | Times this alert repeated (0 if first) |
| `workflow` | enum | Which workflow triggered alert |

---

## Alert Body Structure

### 1. Header
```markdown
# [{SEVERITY}] {Category}: {Brief Description}

**Alert ID:** {alert_id}  
**Detected:** {detected_at} UTC  
**Agent:** {agent} v1.0  
**Workflow:** {workflow}
```

### 2. Executive Summary
```markdown
## Summary

{Risk statement in plain language}

**Impact:** {Worst-case scenario}  
**Likelihood:** {confidence level}  
**Affected Systems:** {scope}
```

### 3. Technical Details
```markdown
## Technical Details

### Evidence
{What was found}

### Location
- **File:** `{absolute_path}`
- **Line:** {line_number} (if applicable)
- **Permissions:** {mode} (owner:group)
- **Size:** {bytes}
- **Modified:** {mtime}

### Content (Redacted)
```
{sanitized_content_preview}
```

### Surrounding Context
- **Parent Directory:** {parent_perms}
- **Related Files:** {related_files}
- **Process Owner:** {uid} ({username})
```

### 4. Risk Analysis
```markdown
## Risk Analysis

### Worst-Case Scenario
{Complete description of maximum damage}

### Attack Vectors
1. {Vector 1}
2. {Vector 2}
3. {Vector 3}

### Indicators of Compromise
- {IOC 1}
- {IOC 2}

### Compliance Impact
- {Regulatory framework}: {impact}
```

### 5. Remediation
```markdown
## Remediation

### Immediate Actions (Now)
1. {Action 1}
2. {Action 2}
3. {Action 3}

### Short-Term Actions (24 hours)
1. {Action 1}
2. {Action 2}

### Long-Term Actions (7 days)
1. {Action 1}
2. {Action 2}

### Verification Steps
```bash
{Commands to verify fix}
```
```

### 6. Context
```markdown
## Context

### Baseline Deviation
{How this differs from known-good state}

### Historical Precedent
{Similar past alerts}

### Related Alerts
- {alert_id_1}: {brief description}
- {alert_id_2}: {brief description}
```

### 7. Footer
```markdown
---

**Alert Digest (SHA256):** {hash}
**Next Review:** {timestamp}
**Auto-Escalate:** {true|false}

_Generated by NeuroSec v1.0 | Read-Only Security Agent_
```

---

## Complete Example Alert

```markdown
---
alert_id: "ns-20260208-204215-a7f3e9d2"
severity: "CRITICAL"
category: "SECRET"
confidence: "High"
detected_at: "2026-02-08T20:42:15Z"
agent: "NeuroSec"
model: "openrouter/moonshotai/kimi-k2.5"
file_count: 1
false_positive_likelihood: "Low"
duplicate_count: 0
workflow: "PostWrite"
---

# [CRITICAL] SECRET: AWS Secret Access Key Exposed

**Alert ID:** ns-20260208-204215-a7f3e9d2  
**Detected:** 2026-02-08T20:42:15Z UTC  
**Agent:** NeuroSec v1.0  
**Workflow:** PostWrite

## Summary

AWS Secret Access Key detected in world-readable configuration file. Immediate credential rotation required.

**Impact:** Complete AWS account takeover, infrastructure destruction, data exfiltration, regulatory penalties (GDPR, SOC2)  
**Likelihood:** High  
**Affected Systems:** AWS infrastructure, production workloads, S3 buckets

## Technical Details

### Evidence
AWS Secret Access Key pattern (`AKIA...`) found in `.env` file with world-readable permissions (mode 644).

### Location
- **File:** `/home/boss/.openclaw/workspace/.env`
- **Line:** 12
- **Permissions:** 644 (boss:boss)
- **Size:** 1,247 bytes
- **Modified:** 2026-02-08T20:41:58Z (17 seconds ago)

### Content (Redacted)
```
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_DEFAULT_REGION=us-east-1
```

### Surrounding Context
- **Parent Directory:** 755 (boss:boss)
- **Related Files:** `.env.example` (644), `.gitignore` (missing .env entry)
- **Process Owner:** 1000 (boss)

## Risk Analysis

### Worst-Case Scenario
Attacker with access to this file gains full AWS administrative privileges. Potential for:
- Complete infrastructure termination (EC2, RDS, Lambda)
- Data exfiltration from all S3 buckets
- IAM user/key creation for persistent access
- Cryptocurrency mining on compromised resources
- Lateral movement to connected systems
- Regulatory fines (GDPR: up to 4% global revenue)

### Attack Vectors
1. **Insider Threat:** Any user on system can read file
2. **Lateral Movement:** Compromised service account accesses file
3. **Backup Exposure:** File included in world-readable backups
4. **Version Control:** Accidental git commit of .env file

### Indicators of Compromise
- Unexpected AWS API calls from non-standard IP addresses
- New IAM users or access keys created
- S3 bucket access logs showing bulk downloads
- EC2 instance type changes (mining)

### Compliance Impact
- **SOC2:** CC6.1 (Logical access security) violation
- **GDPR:** Article 32 (Security of processing) violation
- **PCI-DSS:** Requirement 3.6 (Cryptographic key management) violation

## Remediation

### Immediate Actions (Now)
1. **Rotate AWS credentials immediately:**
   ```bash
   aws iam update-access-key --access-key-id AKIAIOSFODNN7EXAMPLE --status Inactive
   aws iam create-access-key --user-name <username>
   ```
2. **Revoke exposed key:** Delete key from AWS IAM console
3. **Secure file permissions:**
   ```bash
   chmod 600 /home/boss/.openclaw/workspace/.env
   ```
4. **Verify git status:** Ensure .env is not staged or committed

### Short-Term Actions (24 hours)
1. Review AWS CloudTrail logs for unauthorized access
2. Audit S3 bucket access logs
3. Add `.env` to `.gitignore` if missing
4. Implement AWS Config rule for key rotation monitoring

### Long-Term Actions (7 days)
1. Migrate to AWS Secrets Manager or HashiCorp Vault
2. Implement pre-commit hooks for secret detection (git-secrets, detect-secrets)
3. Enable AWS CloudTrail log file validation
4. Implement least-privilege IAM policies
5. Regular (90-day) credential rotation policy

### Verification Steps
```bash
# Verify file permissions
stat -c '%a' /home/boss/.openclaw/workspace/.env
# Expected: 600

# Verify key is inactive
aws iam get-access-key-last-used --access-key-id AKIAIOSFODNN7EXAMPLE
# Expected: Status: Inactive

# Verify no new keys created unexpectedly
aws iam list-access-keys --user-name <username>
```

## Context

### Baseline Deviation
File permissions (644) deviate from expected baseline (600) for credential files. Baseline updated 2026-02-01T00:00:00Z.

### Historical Precedent
Similar alert: ns-20260201-031422-8e9d2a1f (GitHub token exposed, same directory)

### Related Alerts
- ns-20260208-204215-a7f3e9d2: CRITICAL - AWS Secret (this alert)
- ns-20260208-203012-b4c7d8e1: MEDIUM - Missing .gitignore entry

---

**Alert Digest (SHA256):** 8f4a9c2e1b7d5f3a6e0c8b4d2a1f9e7c3b5d8a2e6f0c4b8d2a6e0f4c8b2d6a0e
**Next Review:** 2026-02-08T21:42:15Z
**Auto-Escalate:** true

_Generated by NeuroSec v1.0 | Read-Only Security Agent_
```

---

## Digest Format

Daily digest aggregates all alerts from 24-hour period.

```markdown
---
digest_date: "2026-02-08"
alert_count: 12
critical: 1
high: 3
medium: 5
low: 3
---

# NeuroSec Daily Digest — 2026-02-08

## Executive Summary

12 alerts generated across 4 severity levels. 1 CRITICAL alert requires immediate action.

### Severity Distribution
| Severity | Count | Action Required |
|----------|-------|-----------------|
| CRITICAL | 1 | Immediate |
| HIGH | 3 | Within 24 hours |
| MEDIUM | 5 | Within 7 days |
| LOW | 3 | Within 30 days |

## Critical Alerts

### 1. AWS Secret Access Key Exposed
**Alert ID:** ns-20260208-204215-a7f3e9d2  
**File:** `/home/boss/.openclaw/workspace/.env`  
**Status:** UNRESOLVED  
**Action:** Rotate AWS credentials immediately

[Link to full alert: CRITICAL-SECRET-20260208-204215.md]

## New Alerts (Last 24h)
...

## Resolved Alerts
...

## Trending Patterns
- 2 secret exposure alerts (increasing from baseline)
- 1 permission anomaly in ~/.ssh/ directory
- 3 new network listeners detected

---

_Generated: 2026-02-08T23:59:59Z_
```

---

## Output Constraints

1. **Atomic Writes:** Use temp file + atomic mv
2. **Encoding:** UTF-8 only
3. **Line Endings:** LF (Unix-style)
4. **Max Size:** Single alert 100KB, digest 1MB
5. **Retention:** 30 days, then archive to compressed storage
6. **Permissions:** 644 (world-readable alerts for transparency)

---

_Last updated: 2026-02-08
Version: NeuroSec v1.0
Classification: INTERNAL USE ONLY_
